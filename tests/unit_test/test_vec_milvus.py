from mem.vector_stores.milvus import MilvusDB
from mem.embeddings.embed_api import embedding
import time

import shortuuid

milieus_cfg = {
    "url": "http://7.53.23.160:19530",
    "token": None,
    "collection_name": "memory_test",
    "embedding_model_dims": 1024,
    "metric_type": 'L2'  # L2
}

milvus_inst = MilvusDB(**milieus_cfg)
# milvus_inst.reset()


def test_insert_raw():
    docs = [
        "Machine learning has been used for drug design.",
        "Computational synthesis with AI algorithms predicts molecular properties.",
        "DDR1 is involved in cancers and fibrosis.",
    ]

    vectors = [[0.1]*1024 for i in range(len(docs))]
    ids = [str(shortuuid.uuid()) for i in range(len(docs))]
    payloads = [dict(text=doc) for doc in docs]
    milvus_inst.insert(vectors, payloads=payloads, ids=ids)


def test_search_raw():
    query = "tell me AI related information"
    vector = [-0.035491943359375, 0.0162353515625, -0.007587432861328125, -0.054107666015625, 0.005519866943359375, -0.00408935546875, 0.00965118408203125, 0.0386962890625, -0.058868408203125, -0.00960540771484375, 0.00829315185546875, -0.0633544921875, 0.059112548828125, -0.00965118408203125, -0.045196533203125, 0.072265625, -0.0916748046875, 0.045989990234375, 0.02874755859375, -0.034149169921875, -0.01690673828125, 0.041259765625, -0.0091705322265625, 0.03497314453125, -0.062255859375, -0.02471923828125, -0.05242919921875, 0.0758056640625, -0.023712158203125, -0.0261993408203125, 0.029266357421875, 0.015167236328125, -0.0201873779296875, -0.03192138671875, -0.0399169921875, -0.01383209228515625, -0.004619598388671875, -0.0443115234375, -0.034149169921875, 0.050079345703125, -0.034698486328125, 0.017608642578125, 0.045867919921875, -0.0008249282836914062, -0.035491943359375, -0.050750732421875, 0.1058349609375, -0.01215362548828125, 0.01995849609375, -0.0187225341796875, -0.039886474609375, -0.04156494140625, -0.003887176513671875, -0.003368377685546875, 0.006877899169921875, -0.032989501953125, 0.0386962890625, 0.028106689453125, -0.019866943359375, 0.010040283203125, -0.07763671875, 0.059234619140625, -0.0718994140625, 0.0252838134765625, 0.0215606689453125, 0.005092620849609375, -0.0113372802734375, 0.0004391670227050781, -0.0743408203125, -0.042877197265625, 0.0105133056640625, -0.0006260871887207031, -0.0318603515625, -0.004425048828125, 0.0010423660278320312, 0.01165771484375, -0.037200927734375, -0.02215576171875, 0.022735595703125, 8.410215377807617e-05, -0.00934600830078125, 0.068115234375, 0.0552978515625, 0.0214385986328125, -0.0187530517578125, 0.033111572265625, 0.06158447265625, 0.006237030029296875, 0.038543701171875, -0.0170745849609375, 0.0262603759765625, 0.030029296875, -0.0253753662109375, -0.037384033203125, 0.0309906005859375, -0.030181884765625, -0.007381439208984375, -0.00788116455078125, -0.002971649169921875, 0.0051116943359375, 0.003448486328125, -0.008575439453125, 0.011505126953125, -0.01134490966796875, -0.051055908203125, 0.04229736328125, -0.0877685546875, -0.01947021484375, -0.042999267578125, -0.06121826171875, 0.00852203369140625, 0.0097198486328125, -0.01522064208984375, 0.0290679931640625, 0.01155853271484375, -0.01364898681640625, -0.043212890625, -0.015838623046875, -0.00921630859375, -0.0232696533203125, 0.0196533203125, -0.0112762451171875, -0.016387939453125, 0.005474090576171875, -0.0228118896484375, 0.0235748291015625, -0.019439697265625, -0.01568603515625, 0.0552978515625, -0.0054168701171875, -0.001827239990234375, -0.034637451171875, -0.034515380859375, -0.04083251953125, 0.032379150390625, -0.006351470947265625, 0.0165863037109375, 0.0127410888671875, 0.040863037109375, 0.034698486328125, -0.026153564453125, 0.004711151123046875, -0.0298614501953125, -0.0103302001953125, -0.0029621124267578125, 0.021240234375, 0.004802703857421875, -0.005401611328125, 0.02978515625, -0.013671875, 0.01294708251953125, 0.014190673828125, -0.00934600830078125, -0.01812744140625, -0.0030231475830078125, 0.032196044921875, 0.0012979507446289062, -0.00868988037109375, -0.01117706298828125, 0.0016222000122070312, 0.00855255126953125, 0.0242462158203125, 0.00930023193359375, -0.027801513671875, -0.01544952392578125, -0.0017118453979492188, -0.054290771484375, -0.0281219482421875, 0.012176513671875, -0.047515869140625, -0.009918212890625, 0.00856781005859375, -0.019012451171875, -0.015716552734375, 0.023895263671875, -0.017425537109375, -0.0229339599609375, -0.07476806640625, -0.00925445556640625, 0.01580810546875, 0.004131317138671875, -0.0215606689453125, -0.0239715576171875, 0.0006823539733886719, 0.005645751953125, -0.044189453125, 0.0236053466796875, 0.005207061767578125, -0.03619384765625, 0.0028247833251953125, -0.0199127197265625, -0.029632568359375, -0.05047607421875, -0.007419586181640625, -0.0277099609375, -0.035491943359375, 0.0179595947265625, -0.019256591796875, -0.01070404052734375, -0.00807952880859375, -0.0159912109375, 0.01277923583984375, -0.0033931732177734375, 0.0303192138671875, 0.00302886962890625, -0.018402099609375, 0.0165557861328125, -0.045440673828125, -0.0121917724609375, -0.04193115234375, 0.01666259765625, 0.00782012939453125, -0.051910400390625, 0.018310546875, -0.01971435546875, 0.08514404296875, 0.022430419921875, 0.019744873046875, -0.005031585693359375, 0.0172576904296875, 0.03350830078125, 0.0145721435546875, -0.0187225341796875, 0.00839996337890625, 0.01322174072265625, -0.038421630859375, 0.0107421875, -0.026336669921875, -0.042327880859375, 0.032562255859375, -0.0222015380859375, -0.0531005859375, 0.0178070068359375, 0.00984954833984375, 0.05712890625, -0.020904541015625, -0.006458282470703125, -0.01021575927734375, 0.00753021240234375, -0.002899169921875, -0.054412841796875, 0.00673675537109375, -0.026336669921875, 0.0019006729125976562, -0.0270538330078125, 0.00937652587890625, 0.0009870529174804688, 0.02154541015625, -0.00775146484375, -0.00608062744140625, 0.041259765625, -0.104248046875, -0.006488800048828125, 0.07110595703125, 0.018768310546875, 0.002651214599609375, 0.009490966796875, 0.00531005859375, 0.0170135498046875, 0.01526641845703125, 0.0313720703125, -0.031829833984375, -0.001842498779296875, 0.0017042160034179688, 0.0182647705078125, 0.00850677490234375, -0.004749298095703125, 0.0128021240234375, -0.018463134765625, 0.01971435546875, -0.0191802978515625, -0.001270294189453125, 0.0001933574676513672, 0.002941131591796875, 0.0233154296875, 0.0272369384765625, 0.02740478515625, -0.0252838134765625, 0.0416259765625, 0.06036376953125, -0.006031036376953125, -0.027069091796875, -0.0191802978515625, -0.0557861328125, 0.01317596435546875, 0.045166015625, 0.016815185546875, 0.033447265625, -0.01364898681640625, 0.001003265380859375, 0.035003662109375, -0.02471923828125, -0.042724609375, 0.030120849609375, 0.00896453857421875, 0.030670166015625, -0.0020198822021484375, 0.053497314453125, -0.0009975433349609375, -0.0213775634765625, 0.005619049072265625, -0.030792236328125, -0.0249786376953125, -0.0325927734375, -0.01549530029296875, -0.0133209228515625, 0.042816162109375, -0.0288238525390625, 0.01519012451171875, -0.07684326171875, 0.0809326171875, 0.0128021240234375, 0.0184326171875, -0.006622314453125, -0.00428009033203125, 0.0014820098876953125, 0.015899658203125, 0.08990478515625, -0.015899658203125, -0.0142059326171875, 0.006381988525390625, -0.01806640625, 0.0009069442749023438, -0.01381683349609375, 0.01229095458984375, 9.834766387939453e-05, -0.0450439453125, 0.01342010498046875, 0.006748199462890625, -0.0235443115234375, -0.01160430908203125, 0.02960205078125, 0.034027099609375, -0.01038360595703125, 0.0096893310546875, 0.03814697265625, 0.06671142578125, -0.00615692138671875, 0.01395416259765625, 0.0014820098876953125, -0.01258087158203125, -0.002353668212890625, -0.0176849365234375, -0.039459228515625, -0.01324462890625, -0.068359375, -0.037567138671875, 0.035858154296875, 0.0015268325805664062, 0.018798828125, 0.01806640625, -0.01071929931640625, 0.0173492431640625, 0.034515380859375, -0.074462890625, 0.0198974609375, 0.02947998046875, 0.06939697265625, -0.00897216796875, -0.018280029296875, 0.0022220611572265625, -0.05023193359375, 0.0020999908447265625, -0.01160430908203125, -0.0299530029296875, 0.01412200927734375, 0.0008959770202636719, -0.038330078125, 0.045074462890625, 0.0259857177734375, -0.07464599609375, -0.011962890625, -0.0406494140625, 0.0128936767578125, 0.05084228515625, 0.04547119140625, 0.0677490234375, -0.0219879150390625, 0.005893707275390625, 0.0277099609375, -0.001071929931640625, 0.0228118896484375, 0.004802703857421875, 0.0208740234375, -0.0146331787109375, -0.0226898193359375, 0.0005936622619628906, -0.0192413330078125, -0.01549530029296875, -0.0060577392578125, 0.0249176025390625, 0.035186767578125, 0.060302734375, 0.01157379150390625, 0.0243682861328125, -0.0148162841796875, -0.0423583984375, -0.02227783203125, -0.0020160675048828125, -0.00968170166015625, 0.03521728515625, 0.0006341934204101562, -0.11444091796875, 0.034759521484375, -0.001861572265625, -0.0214080810546875, -0.0211639404296875, 0.007076263427734375, 0.036376953125, 0.00165557861328125, 0.024444580078125, -0.02825927734375, 0.00496673583984375, -0.0216064453125, 0.052398681640625, -0.040283203125, 0.11260986328125, -0.00788116455078125, 0.0019969940185546875, -0.00057220458984375, -0.045318603515625, 0.06103515625, -0.036376953125, -0.04681396484375, -0.0308685302734375, 0.0267333984375, -0.054931640625, -0.005794525146484375, -0.027587890625, 0.07147216796875, -0.036529541015625, -0.0263824462890625, -0.026092529296875, 0.0250091552734375, -0.02166748046875, -0.003322601318359375, 0.057769775390625, -0.0020618438720703125, -0.021759033203125, -0.03955078125, -0.018463134765625, 0.035797119140625, 0.026123046875, -0.03594970703125, -0.01336669921875, -0.0282135009765625, -0.024322509765625, -0.005321502685546875, -0.015960693359375, -0.00518035888671875, 0.04296875, -0.0240631103515625, 0.0125579833984375, 0.043487548828125, 0.004673004150390625, -0.033416748046875, -0.03900146484375, -0.03106689453125, 0.01204681396484375, 0.01386260986328125, -0.00870513916015625, 0.003108978271484375, -0.0257568359375, -0.018829345703125, -0.028289794921875, 0.0168609619140625, 0.0269927978515625, 0.00640106201171875, 0.027435302734375, 0.004241943359375, 0.01267242431640625, 0.05511474609375, -0.00024437904357910156, -0.02960205078125, -0.027862548828125, 0.01641845703125, -0.10528564453125, 0.0084381103515625, -0.0416259765625, 0.02886962890625, 0.053375244140625, -0.038543701171875, 0.0217437744140625, -0.0225830078125, 0.07476806640625, -0.037384033203125, 0.032318115234375, -0.06573486328125, -0.07659912109375, 0.00208282470703125, -0.004802703857421875, 0.0218963623046875, -0.0085906982421875, -0.07470703125, 0.00252532958984375, -0.0782470703125, -0.026947021484375, 0.0088958740234375, -0.10430908203125, -0.00045871734619140625, 0.004909515380859375, 0.02978515625, -0.04132080078125, -0.0010194778442382812, 0.018524169921875, -0.01311492919921875, 0.00342559814453125, -0.0126495361328125, 0.04534912109375, 0.022430419921875, 0.006580352783203125, -0.038787841796875, -0.0462646484375, 0.034454345703125, -0.01273345947265625, 0.0286865234375, 0.032318115234375, 0.051849365234375, 0.0169830322265625, 0.0325927734375, 0.055938720703125, 0.0264129638671875, 0.048431396484375, -0.053375244140625, 0.0168609619140625, 0.0594482421875, 0.00843048095703125, -0.0254974365234375, -0.0258331298828125, 0.006717681884765625, -0.016632080078125, 0.05609130859375, 0.01514434814453125, 0.018035888671875, -0.00971221923828125, -0.0123138427734375, 0.01290130615234375, -0.0115966796875, -0.018280029296875, 0.0125885009765625, 0.00894927978515625, -0.006359100341796875, -0.0258026123046875, -0.0504150390625, 0.01678466796875, -0.040313720703125, -0.07012939453125, 0.0015802383422851562, -0.01727294921875, 0.051788330078125, 0.0135955810546875, 0.00807952880859375, 0.07080078125, -0.02862548828125, 0.0203704833984375, -0.032012939453125, 0.0269927978515625, 0.00408172607421875, 0.0302581787109375, -0.027496337890625, -0.035369873046875, -0.038421630859375, -0.032196044921875, 0.01352691650390625, 0.001293182373046875, -0.017974853515625, 0.0103759765625, -0.0032863616943359375, 0.06787109375, -0.024688720703125, 0.02801513671875, -0.0234527587890625, 0.030914306640625, 0.03277587890625, 0.035400390625, -0.016571044921875, 0.0223236083984375, 0.01153564453125, 0.01959228515625, -0.04962158203125, -0.01873779296875, 0.00860595703125, -0.026031494140625, -0.0008435249328613281, -0.040374755859375, -0.00653839111328125, 0.0306549072265625, 0.0242156982421875, 0.0258026123046875, -0.021087646484375, 0.01464080810546875, 0.014129638671875, -0.061187744140625, 0.0113677978515625, 0.0379638671875, -0.0259246826171875, -0.0165863037109375, -0.002044677734375, 0.0201568603515625, 0.0200653076171875, 0.040191650390625, 0.048492431640625, -0.00896453857421875, -0.039520263671875, -0.037109375, 0.063720703125, -0.01873779296875, 0.03851318359375, -0.00824737548828125, 0.0219268798828125, 0.0014982223510742188, 0.01247406005859375, -0.0311431884765625, 0.005809783935546875, 0.004947662353515625, -0.033355712890625, 0.0089111328125, 0.03546142578125, 0.0224151611328125, -0.086669921875, 0.00870513916015625, 0.023956298828125, -0.01270294189453125, 0.05279541015625, 0.01363372802734375, -0.00606536865234375, -0.012939453125, -0.04241943359375, 0.007564544677734375, -0.02337646484375, 0.016754150390625, -0.01152801513671875, -0.0115966796875, -0.002307891845703125, -0.003551483154296875, 0.033447265625, -0.032135009765625, 0.0008234977722167969, 0.06817626953125, -0.011505126953125, -0.043792724609375, -0.05487060546875, -0.0013895034790039062, 0.003650665283203125, 0.03155517578125, 0.007965087890625, -0.0499267578125, 0.0023441314697265625, 0.041748046875, -0.0234375, 0.066650390625, -0.00531768798828125, 0.00909423828125, 0.0003502368927001953, -0.04443359375, 0.023895263671875, -0.0236968994140625, 0.031829833984375, 0.01435089111328125, -0.062469482421875, 0.014007568359375, -0.06854248046875, 0.01605224609375, -0.025543212890625, -0.0379638671875, -0.0284271240234375, 0.054901123046875, 0.035369873046875, 0.004108428955078125, -0.03448486328125, -0.01806640625, -0.0115509033203125, 0.0130462646484375, 0.0163421630859375, 0.0051422119140625, -0.0379638671875, -0.03680419921875, -0.02801513671875, -0.007007598876953125, -0.0631103515625, -0.0242156982421875, -0.01080322265625, 0.006076812744140625, -0.03631591796875, 0.047393798828125, -0.007904052734375, -0.038543701171875, 0.06951904296875, 0.0216827392578125, -0.0140228271484375, -0.0360107421875, -0.0205535888671875, 0.045074462890625, -0.032257080078125, -0.04156494140625, -0.0069427490234375, -0.025299072265625, -0.032135009765625, -0.0089874267578125, -0.00849151611328125, -0.027374267578125, -0.0237884521484375, -0.06597900390625, 0.0180511474609375, 0.018402099609375, 0.0280609130859375, -0.06304931640625, 0.0007634162902832031, -0.0185699462890625, 0.00612640380859375, 0.031890869140625, 0.0235137939453125, 0.005558013916015625, 0.0194091796875, 0.017364501953125, 0.00876617431640625, -0.026031494140625, -0.01558685302734375, -0.01189422607421875, -0.035980224609375, 0.007320404052734375, 0.0016384124755859375, 0.058746337890625, 0.037200927734375, -0.00354766845703125, 0.0233917236328125, 0.039215087890625, 0.0187530517578125, 0.0333251953125, -0.008026123046875, 0.0276336669921875, -0.03472900390625, -0.01751708984375, -0.033050537109375, 0.01068115234375, 0.0288238525390625, 0.059600830078125, 0.0252838134765625, -0.003082275390625, -0.02532958984375, 0.0259246826171875, -0.0031223297119140625, -0.045196533203125, -0.00331878662109375, 0.037933349609375, 0.01181793212890625, -0.0223388671875, -0.041900634765625, 0.032073974609375, -0.01116943359375, 0.04437255859375, -0.0255584716796875, -0.0229339599609375, 0.0308380126953125, -0.057525634765625, -0.036834716796875, 0.00390625, 0.0546875, 0.0230560302734375, 0.0009045600891113281, -0.048980712890625, 0.02398681640625, 0.00045943260192871094, 0.049163818359375, 0.0289459228515625, -0.0095062255859375, 0.0264892578125, -0.04974365234375, -0.01084136962890625, -0.050994873046875, 0.032806396484375, 0.0026531219482421875, 0.0128936767578125, 0.0657958984375, 0.018890380859375, 0.004467010498046875, 0.01001739501953125, -0.0046234130859375, -0.00798797607421875, 0.0144195556640625, 0.029083251953125, 0.009429931640625, 0.00876617431640625, -0.05303955078125, -0.017578125, 0.03607177734375, 0.01021575927734375, -0.01348876953125, 0.056640625, 0.03790283203125, -0.0110626220703125, -0.005062103271484375, -0.0256195068359375, 0.019622802734375, -0.0098419189453125, 0.0127716064453125, -0.0186614990234375, 0.024444580078125, 0.01169586181640625, -0.0182647705078125, 0.0253753662109375, 0.040191650390625, -0.07342529296875, -0.057403564453125, 0.023712158203125, 0.002285003662109375, -0.044281005859375, 0.04254150390625, -0.0181732177734375, 0.01486968994140625, 0.040008544921875, 0.06622314453125, 0.01248931884765625, -0.0008673667907714844, 0.01078033447265625, 0.0104827880859375, -0.004398345947265625, 0.0092315673828125, -0.006320953369140625, -0.018951416015625, -0.044921875, -0.00396728515625, 0.0284881591796875, 0.0294647216796875, -0.06689453125, 0.0236053466796875, 0.035736083984375, 0.009429931640625, -0.0182647705078125, 0.005702972412109375, 0.018402099609375, -0.0430908203125, 0.0257415771484375, 0.01418304443359375, 0.038421630859375, 0.0301971435546875, -0.03271484375, -0.0038738250732421875, -0.0159759521484375, 0.0209197998046875, 0.0198974609375, 0.0088043212890625, 0.00348663330078125, 0.0292205810546875, -0.0159759521484375, 0.0207061767578125, -0.0015764236450195312, -0.0200653076171875, 0.0143890380859375, -0.027496337890625, 0.0074310302734375, 0.06195068359375, -0.0199432373046875, -0.016357421875, -0.0650634765625, 0.04248046875, -0.0101318359375, 0.046661376953125, -0.031890869140625, 0.0207061767578125, -0.0038623809814453125, -0.007236480712890625, -0.0219573974609375, -0.027374267578125, 0.017669677734375, 0.07464599609375, -0.0169525146484375, 0.067138671875, -0.006317138671875, -0.006534576416015625, -0.01012420654296875, -0.03607177734375, 0.007106781005859375, 0.033966064453125, -0.04052734375, -0.004367828369140625, 0.00420379638671875, -0.006317138671875, -0.0033111572265625, 0.0469970703125, -0.040924072265625, 0.01355743408203125, 0.0447998046875, -0.016143798828125, -0.0176544189453125, -0.017364501953125, 0.0165557861328125, -0.01146697998046875, -0.0157012939453125, -0.043792724609375, 0.027099609375, -0.0245513916015625, -0.01384735107421875, -0.0029888153076171875, -0.11328125, 0.00583648681640625, 0.00811767578125, 0.00742340087890625, -0.005008697509765625, -0.0232086181640625, 0.024505615234375, -0.023895263671875, -0.01806640625, -0.004367828369140625, -0.04486083984375, 0.006221771240234375, 0.021087646484375, 0.007137298583984375, -0.037109375, 0.0032501220703125, -0.01415252685546875, 0.0560302734375, 0.0188446044921875, -0.0197296142578125, -0.0171661376953125, -0.006946563720703125, -0.05584716796875, -0.040771484375, 0.032379150390625, -0.01007843017578125, 0.046661376953125, -0.00835418701171875, 0.01031494140625, 0.0131378173828125, -0.03302001953125, -0.02874755859375, -0.018524169921875, 0.009490966796875, -0.022918701171875, 0.013336181640625, 0.0309295654296875, -0.00772857666015625, 0.0069427490234375, 0.0293731689453125, 0.001491546630859375, 0.0011816024780273438, 0.0204620361328125, -0.026458740234375, 0.0170440673828125, -0.007030487060546875, 0.026275634765625, -0.0011472702026367188, 0.047210693359375, 0.01336669921875, 0.007904052734375, -0.051788330078125, 0.005130767822265625, -0.01522064208984375, 0.0244140625, -0.0262908935546875, 0.01116943359375, 0.0284576416015625, 0.0068511962890625, 0.039337158203125, -0.0295257568359375, -0.0751953125, -0.046478271484375, -0.00701141357421875, 0.01947021484375, 0.027496337890625, 0.01416015625, 0.00824737548828125, 0.0171356201171875, 0.0210113525390625, 0.050933837890625, 0.019317626953125, 0.0160369873046875, 0.049652099609375, 0.02655029296875, 0.015289306640625, -0.0078887939453125, -0.018035888671875, -0.0168914794921875, 0.033905029296875, 0.0179290771484375, -0.00063323974609375, -0.0269317626953125, 0.00978851318359375, -0.0237274169921875, -0.03338623046875, -0.021240234375, -0.01153564453125, 0.0343017578125, 0.0219573974609375, 0.0006475448608398438, -0.005466461181640625, 0.016387939453125, 0.055023193359375, -0.022003173828125, -0.0576171875, -0.00231170654296875, 0.035308837890625, -0.0090484619140625, 0.0155487060546875, 0.0114288330078125, -0.0379638671875, -0.0118255615234375, -0.0045318603515625, 0.022125244140625, -0.0030727386474609375, -0.0013685226440429688, -1.5556812286376953e-05, -0.01311492919921875, 0.015960693359375, -0.005809783935546875, 0.01261138916015625, -0.0017538070678710938, 0.003963470458984375, 0.0127410888671875, 0.0289764404296875, -0.0034046173095703125, 0.0115203857421875, 0.0160675048828125, 0.00775146484375, -0.0030460357666015625, -0.00803375244140625, -0.0084228515625, -0.00423431396484375, -0.00679779052734375, -0.03338623046875, -0.001041412353515625, 0.024871826171875, 0.024871826171875, 0.00928497314453125]
    result = milvus_inst.search(query, vector, limit=5)
    print(result)


def test_insert():
    # milvus_inst.reset()
    # Insert more docs in another subject.
    docs = [
        "Machine learning has been used for drug design.",
        "Computational synthesis with AI algorithms predicts molecular properties.",
        "DDR1 is involved in cancers and fibrosis.",
    ]
    vectors = embedding(docs)
    ids = [str(shortuuid.uuid()) for i in range(len(docs))]
    payloads = [dict(text=doc) for doc in docs]
    milvus_inst.insert(vectors, payloads=payloads, ids=ids)


def test_search():
    query = "tell me AI related information"
    vector = embedding(query)
    t_start = time.time()
    result = milvus_inst.search(query, vector, limit=5)
    print(time.time()-t_start, result)


def test_delete():
    vector_id = '4W7fYAXea9Nh6eV572V3RC'
    milvus_inst.delete(vector_id)


def test_update():
    vector_id = 'AP7gurVbYG8NwRg9Qwhuev'
    text = 'Machine learning has been used for drug design, it not bad!'
    vector = embedding(text)
    payload = dict(text=text)
    milvus_inst.update(vector_id, vector=vector, payload=payload)


def test_get():
    vector_id = 'AP7gurVbYG8NwRg9Qwhuev'
    result = milvus_inst.get(vector_id)
    print(result)


def test_batch():

    t_start = time.time()
    num = 100
    for i in range(0, num):
        print(i, time.time() - t_start)
        # test_insert_raw()
        # test_insert()
        # test_search()
        test_search_raw()

    t_cost = time.time() - t_start
    print(f'avg time:{t_cost/num}')


if __name__ == "__main__":
    # test_insert()
    # time.sleep(3)
    # test_search()

    # test_delete()
    # time.sleep(1)
    # test_search()

    # test_update()
    # test_get()
    test_batch()

